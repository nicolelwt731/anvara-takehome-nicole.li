# Setup Guide

This guide will help you get the Anvara Take-Home Test running on your machine.

## Prerequisites

Before you begin, make sure you have:

- **Node.js 20+** - [Download](https://nodejs.org/)
- **pnpm 9+** - Installed via npm or corepack
- **Docker Desktop** - [Download](https://www.docker.com/products/docker-desktop/)

### Install pnpm

If you don't have pnpm installed:

```bash
npm install -g pnpm
```

## Platform Support

This project works on:

- ‚úÖ **macOS** (Intel and Apple Silicon)
- ‚úÖ **Windows** (10/11 via PowerShell, CMD, or Git Bash)
- ‚úÖ **Linux** (Ubuntu, Debian, Fedora, etc.)

All scripts use cross-platform tools to ensure compatibility.

## Quick Setup (Recommended)

Run the automated setup script:

```bash
pnpm setup-project
```

This will:

1. ‚úÖ Check prerequisites (Node.js, pnpm, Docker)
2. ‚úÖ Copy `.env.example` to `.env`
3. ‚úÖ Install all dependencies
4. ‚úÖ Start Docker containers (PostgreSQL on port 5498)
5. ‚úÖ Generate Prisma client
6. ‚úÖ Apply database schema
7. ‚úÖ Seed the database with sample data

## Manual Setup

If you prefer step-by-step setup:

### 1. Install Dependencies

```bash
pnpm install
```

### 2. Configure Environment

```bash
# Unix/Mac
cp .env.example .env

# Windows (Command Prompt)
copy .env.example .env

# Windows (PowerShell)
Copy-Item .env.example .env
```

### 3. Start Database

```bash
docker-compose up -d
```

### 4. Setup Prisma

```bash
cd apps/backend
pnpm db:generate
pnpm db:push
pnpm db:seed
```

## Environment Variables

The `.env` file contains all necessary configuration:

```bash
# Database (auto-generated with random credentials)
DATABASE_URL=postgresql://postgres:<password>@localhost:5498/<db_name>

# Backend API
BACKEND_PORT=4291
NEXT_PUBLIC_API_URL=http://localhost:4291

# Authentication (Better Auth)
BETTER_AUTH_SECRET=<auto-generated>
BETTER_AUTH_URL=http://localhost:3847
```

> **Note:** The setup script generates unique credentials automatically.

## Authentication Setup

This project uses **Better Auth** - a free, open-source authentication library. No third-party setup required!

### Demo Accounts

Two demo accounts are automatically created:

| Role      | Email                 | Password   |
| --------- | --------------------- | ---------- |
| Sponsor   | sponsor@example.com   | `password` |
| Publisher | publisher@example.com | `password` |

Use these credentials to log in at `/login`.

## Development Commands

```bash
# Start all services (frontend + backend)
pnpm dev

# Run type checking
pnpm typecheck

# Lint code
pnpm lint

# Fix lint errors
pnpm lint:fix

# Format code
pnpm format

# Run tests
pnpm test

# Open Prisma Studio (visual database browser)
pnpm --filter @anvara/backend db:studio
```

### üéØ Pro Tip: Use Prisma Studio

Prisma Studio is a visual database browser that makes debugging **much easier**:

```bash
pnpm --filter @anvara/backend db:studio
```

Opens at http://localhost:5555. Use it to:

- ‚úÖ **Verify seeded data** - See the demo sponsors, publishers, campaigns, and ad slots
- ‚úÖ **Debug CRUD operations** - Check if your create/update/delete actually worked
- ‚úÖ **Inspect relationships** - View how sponsors, campaigns, and other models connect
- ‚úÖ **Test edge cases** - Manually modify data to test your error handling

This is incredibly helpful when working on Challenges 3-5!

## Services & Ports

Once running, you can access:

| Service           | URL                   | Port | Notes                             |
| ----------------- | --------------------- | ---- | --------------------------------- |
| Frontend          | http://localhost:3847 | 3847 | Next.js app                       |
| Backend API       | http://localhost:4291 | 4291 | Express server                    |
| PostgreSQL        | localhost:5498        | 5498 | Docker container                  |
| **Prisma Studio** | http://localhost:5555 | 5555 | **Visual DB browser - use this!** |

## Verify Setup

After setup completes:

1. ‚úÖ Visit http://localhost:3847
2. ‚úÖ Click "Login"
3. ‚úÖ Log in with `sponsor@example.com` / `password`
4. ‚úÖ You should see the sponsor dashboard

## Troubleshooting

### Docker Issues

```bash
# Check if Docker is running
docker ps

# Restart Docker containers
docker-compose down
docker-compose up -d
```

### Database Issues

```bash
# Reset database
cd apps/backend
pnpm db:push --force-reset
pnpm db:seed
```

### Port Conflicts

If ports 3847, 4291, or 5498 are already in use, update the `.env` file:

```bash
BACKEND_PORT=4292  # Change to available port
# Update NEXT_PUBLIC_API_URL accordingly
```

### pnpm Issues

```bash
# Clear pnpm cache
pnpm store prune

# Reinstall dependencies
rm -rf node_modules
pnpm install
```

## Next Steps

Once your environment is set up:

1. üìñ Read the [Challenges Overview](challenges/README.md)
2. üèÅ Start with [Challenge 1: TypeScript Errors](challenges/01-typescript.md)
3. üíæ Commit frequently as you work

## Resources

- [TypeScript Documentation](https://www.typescriptlang.org/docs/)
- [Prisma Documentation](https://www.prisma.io/docs/)
- [Next.js Documentation](https://nextjs.org/docs)
- [Express.js Guide](https://expressjs.com/)
- [Better Auth Documentation](https://www.better-auth.com/docs)
