// Anvara Sponsorship Marketplace Schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// NOTE: User authentication is handled by Better Auth
// Better Auth manages: user, session, account, verification tables
// See: apps/frontend/auth.ts for configuration
// ============================================================================

// ============================================================================
// CORE ENTITIES
// ============================================================================

model Sponsor {
  id          String   @id @default(cuid())
  userId      String?  @unique // Links to Better Auth user.id
  name        String
  email       String   @unique
  website     String?
  logo        String?
  description String?
  industry    String?

  subscriptionTier SubscriptionTier @default(FREE)
  subscriptionEndsAt DateTime?

  isVerified  Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  campaigns   Campaign[]
  payments    Payment[]

  @@map("sponsors")
}

model Publisher {
  id          String   @id @default(cuid())
  userId      String?  @unique // Links to Better Auth user.id
  name        String
  email       String   @unique
  website     String?
  avatar      String?
  bio         String?

  monthlyViews    Int      @default(0)
  subscriberCount Int      @default(0)
  category        String?

  isVerified  Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  adSlots     AdSlot[]
  placements  Placement[]

  @@map("publishers")
}

// ============================================================================
// CAMPAIGNS & ADS
// ============================================================================

model Campaign {
  id          String   @id @default(cuid())
  name        String
  description String?

  budget      Decimal  @db.Decimal(10, 2)
  spent       Decimal  @default(0) @db.Decimal(10, 2)
  cpmRate     Decimal? @db.Decimal(10, 2)
  cpcRate     Decimal? @db.Decimal(10, 2)

  startDate   DateTime
  endDate     DateTime

  targetCategories String[]
  targetRegions    String[]

  status      CampaignStatus @default(DRAFT)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sponsorId   String
  sponsor     Sponsor    @relation(fields: [sponsorId], references: [id], onDelete: Cascade)
  creatives   Creative[]
  placements  Placement[]

  @@map("campaigns")
}

model Creative {
  id          String   @id @default(cuid())
  name        String
  type        CreativeType

  assetUrl    String
  clickUrl    String
  altText     String?

  width       Int?
  height      Int?

  isApproved  Boolean  @default(false)
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  campaignId  String
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  placements  Placement[]

  @@map("creatives")
}

model AdSlot {
  id          String   @id @default(cuid())
  name        String
  description String?

  type        AdSlotType
  position    String?
  width       Int?
  height      Int?

  basePrice   Decimal  @db.Decimal(10, 2)
  cpmFloor    Decimal? @db.Decimal(10, 2)

  isAvailable Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  publisherId String
  publisher   Publisher  @relation(fields: [publisherId], references: [id], onDelete: Cascade)
  placements  Placement[]

  @@map("ad_slots")
}

model Placement {
  id          String   @id @default(cuid())

  impressions Int      @default(0)
  clicks      Int      @default(0)
  conversions Int      @default(0)

  agreedPrice Decimal  @db.Decimal(10, 2)
  pricingModel PricingModel @default(CPM)

  startDate   DateTime
  endDate     DateTime

  status      PlacementStatus @default(PENDING)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  campaignId  String
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  creativeId  String
  creative    Creative   @relation(fields: [creativeId], references: [id], onDelete: Cascade)
  adSlotId    String
  adSlot      AdSlot     @relation(fields: [adSlotId], references: [id], onDelete: Cascade)
  publisherId String
  publisher   Publisher  @relation(fields: [publisherId], references: [id], onDelete: Cascade)

  @@map("placements")
}

model Payment {
  id          String   @id @default(cuid())

  amount      Decimal  @db.Decimal(10, 2)
  currency    String   @default("USD")

  type        PaymentType
  status      PaymentStatus @default(PENDING)

  stripePaymentId String?
  invoiceUrl      String?

  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sponsorId   String
  sponsor     Sponsor    @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// ============================================================================
// ENUMS
// ============================================================================

enum SubscriptionTier {
  FREE
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum CampaignStatus {
  DRAFT
  PENDING_REVIEW
  APPROVED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CreativeType {
  BANNER
  VIDEO
  NATIVE
  SPONSORED_POST
  PODCAST_READ
}

enum AdSlotType {
  DISPLAY
  VIDEO
  NATIVE
  NEWSLETTER
  PODCAST
}

enum PricingModel {
  CPM
  CPC
  CPA
  FLAT_RATE
}

enum PlacementStatus {
  PENDING
  APPROVED
  ACTIVE
  PAUSED
  COMPLETED
  REJECTED
}

enum PaymentType {
  SUBSCRIPTION
  CAMPAIGN_FUNDING
  REFUND
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}
